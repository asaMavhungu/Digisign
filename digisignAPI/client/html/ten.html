<!DOCTYPE html>
<html>
<head>
    <title>Devices Page</title>
</head>
<body>
    <h1>Devices Data</h1>
    <ul id="responseDataList"></ul>

    <div id="errorMessage" style="color: red;"></div>

    <script>
        // JavaScript code to retrieve the JWT token and send authorized requests
        const accessToken = localStorage.getItem('access_token');
        if (!accessToken) {
            // Redirect to the login page if the token is missing
            window.location.href = '/login'; // Replace with the actual URL
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Send authorized GET request to the protected API endpoint
            fetch('/api/devices', {
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                },
            })
            .then(response => {
                if (response.status === 401) {
                    // Token has expired, show an error message to the user
                    const errorMessage = document.getElementById('errorMessage');
                    errorMessage.textContent = 'API token has expired. Please log in again.';
                    return null; // Don't proceed with processing the response
                }
                return response.json();
            })
            .then(data => {
                if (data) {
                    const responseDataList = document.getElementById('responseDataList');
                    responseDataList.innerHTML = '';

                    data.forEach(item => {
                        const listItem = document.createElement('li');
                        listItem.textContent = `Name: ${item.name}, Description: ${item.description}`;
                        responseDataList.appendChild(listItem);
                    });
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    </script>
</body>
</html>
